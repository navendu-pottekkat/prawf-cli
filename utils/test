package utils

import (
	"log"

	v "github.com/spf13/viper"
)

const (
	ConfigName = "prawf"
	ConfigType = "json"
)

type PrawfConfig struct {
	Tests       []Test `json:"tests"`
	CurrentTest string `json:"current-test"`
}

type Test struct {
	URL     string   `json:"url"`
	Methods []Method `json:"methods"`
}

type Method struct {
	Path   string                 `json:"path"`
	Method string                 `json:"method"`
	Query  map[string]interface{} `json:"query,omitempty"`
	Body   map[string]interface{} `json:"body,omitempty"`
}

type Config struct {
	Test        string `json:"test"`
	CurrentTest string `json:"current"`
}

var templateMethods = []Method{
	{
		Path:   "/user",
		Method: "GET",
	},
	{
		Path:   "/user",
		Method: "POST",
	},
}

var templateTest = Test{
	URL:     "http://localhost:9090",
	Methods: templateMethods,
}

func GetPrawfConfig(configName string, configPath string) (*Config, error) {

	v.SetConfigName(configName)
	v.SetConfigType(ConfigType)
	v.AddConfigPath(configPath)

	err := v.ReadInConfig()
	if err != nil {
		log.Fatal(err)
	}

	c := &Config{}

	err = v.Unmarshal(&c)
	if err != nil {
		return nil, err
	}
	return c, err
}
